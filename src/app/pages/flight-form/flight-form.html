<!-- Profile dropdown -->
<div class="profile-container">
  <div class="profile-icon" (click)="toggleDropdown()">
    {{ userInitials }}
  </div>
  <div class="dropdown-menu" *ngIf="dropdownOpen">
    <p class="dropdown-user">
      {{ userDisplayName || userEmail }}
    </p>
    <hr />
    <a (click)="logout()">Logout</a>
  </div>
</div>

<!-- Flight form -->
<div class="flight-form-page">
  <div class="flight-form-container">
    <div class="form-header">
      <h2>Flight Information</h2>
    </div>

    <form [formGroup]="form" (ngSubmit)="submit()">
      <!-- Airline -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Airline</mat-label>
        <input matInput formControlName="airline" />
        <mat-error *ngIf="form.get('airline')?.hasError('required')">
          Airline is required
        </mat-error>
      </mat-form-field>

      <!-- Arrival Date -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Arrival Date</mat-label>
        <input matInput [matDatepicker]="picker" formControlName="arrivalDate" />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-error *ngIf="form.get('arrivalDate')?.hasError('required')">
          Arrival date is required
        </mat-error>
      </mat-form-field>

      <!-- Arrival Time -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Arrival Time</mat-label>
        <input matInput [ngxMatTimepicker]="timePicker" formControlName="arrivalTime" readonly />
        <!-- Proper suffix icon -->
        <mat-icon matSuffix (click)="timePicker.open()" class="timepicker-icon">
          access_time
        </mat-icon>

        <ngx-mat-timepicker
          #timePicker
          [format]="24"
          (timeSet)="onTimeSelected($event)"
        ></ngx-mat-timepicker>

        <mat-error *ngIf="form.get('arrivalTime')?.hasError('required')">
          Arrival time is required
        </mat-error>
        <mat-error *ngIf="form.get('arrivalTime')?.hasError('invalidTime')">
          Invalid time format
        </mat-error>
      </mat-form-field>

      <!-- Flight Number -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Flight Number</mat-label>
        <input matInput formControlName="flightNumber" />
        <mat-error *ngIf="form.get('flightNumber')?.hasError('required')">
          Flight number is required
        </mat-error>
      </mat-form-field>

      <!-- Number of Guests -->
      <!-- Number of Guests -->
      <div class="guest-input">
        <label>Number of Guests</label>
        <div class="guest-controls">
          <button type="button" (click)="decreaseGuests()">âˆ’</button>
          <input formControlName="numOfGuests" readonly />
          <button type="button" (click)="increaseGuests()">+</button>
        </div>
        <div class="error-text" *ngIf="form.get('numOfGuests')?.hasError('min')">
          At least 1 guest is required
        </div>
      </div>

      <!-- Comments -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Comments (optional)</mat-label>
        <textarea matInput formControlName="comments"></textarea>
      </mat-form-field>

      <!-- Global API error -->
      <div *ngIf="apiError" class="error-text">
        {{ apiError }}
      </div>

      <!-- Global success -->
      <div class="success-text"></div>

      <!-- Submit -->
      <button mat-raised-button color="primary" type="submit" [disabled]="loading">
        {{ loading ? 'Submitting...' : 'Submit' }}
      </button>
    </form>
  </div>
</div>
